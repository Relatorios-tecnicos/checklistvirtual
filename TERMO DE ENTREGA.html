<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Termo de Entrega</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #525659; display: flex; justify-content: center; }
        
        .page { 
            background: white; 
            width: 794px; 
            height: 1120px; 
            padding: 30px 50px; 
            position: relative; 
            display: flex; 
            flex-direction: column;
            overflow: hidden;
        }

        .embratel-bg { 
            position: absolute; 
            bottom: 350px; 
            left: 50%; 
            transform: translateX(-50%); 
            width: 350px; 
            opacity: 0.15; /* Ajustado para não cobrir o texto */
            z-index: 1; 
            pointer-events: none; 
        }

        .content { position: relative; z-index: 2; height: 100%; display: flex; flex-direction: column; }
        .header-logo { text-align: right; margin-bottom: 10px; }
        .logo-claro { max-width: 140px; height: auto; }
        
        .title { text-align: center; font-weight: bold; font-size: 14px; margin-bottom: 15px; }
        .title input { font-size: 14px; width: 120px; text-align: center; font-weight: bold; border: none; background: #f9f9f9; }

        .text-body { font-size: 13px; line-height: 1.5; text-align: justify; margin-bottom: 10px; }
        .input-fill { border: none; border-bottom: 1px solid #ccc; font-weight: bold; outline: none; background: transparent; }

        .table-container { width: 100%; display: flex; justify-content: center; margin-bottom: 10px; }
        .item-table { width: 80%; border-collapse: collapse; }
        .item-table th, .item-table td { border: 1px solid black; padding: 6px; font-size: 12px; }
        .item-table th { background-color: #eeeeee !important; -webkit-print-color-adjust: exact; }
        
        .td-center { text-align: center !important; }
        .td-center input { text-align: center; width: 100%; border: none; outline: none; background: transparent; font-family: Arial, sans-serif; }
        .input-bold { font-weight: bold; font-size: 12px; }

        .obs { font-size: 10px; font-style: italic; margin-bottom: 15px; color: #333; }

        .sig-section { margin-top: 5px; }
        .sig-row { margin-bottom: 5px; display: flex; align-items: flex-end; }
        .sig-label { width: 90px; font-size: 13px; }
        .sig-box { 
            width: 350px; 
            height: 50px; 
            border-bottom: 2px solid black; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            cursor: pointer;
        }
        .sig-box img { max-height: 100%; mix-blend-mode: multiply; }
        .label-sub { font-size: 9px; margin-left: 95px; font-weight: bold; margin-bottom: 15px; display: block; }

        .date-footer { 
            position: absolute;
            bottom: 60px; 
            right: 50px;
            font-size: 13px; 
            text-align: right;
            white-space: nowrap; 
            width: auto;
        }
        .date-input { border: none !important; border-bottom: 1px solid #000 !important; outline: none !important; text-align: center; background: transparent; }

        @media print { 
            @page { size: A4; margin: 0; } 
            body { background: white; }
            .page { width: 100%; height: 100vh; padding: 30px 60px; zoom: 1; box-shadow: none; } 
            .btn-panel, #sig-modal { display: none; } 
        }

        #sig-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 9999; justify-content: center; align-items: center; flex-direction: column; }
        .modal-content { background: white; width: 95%; border-radius: 8px; }
        #modal-canvas { background: #fff; width: 100%; height: 350px; touch-action: none; }
        .modal-footer { display: flex; padding: 10px; gap: 5px; }
        .btn-modal { flex: 1; padding: 15px; border: none; border-radius: 4px; font-weight: bold; color: white; }
        .btn-panel { position: fixed; top: 10px; right: 10px; z-index: 1000; }
        .btn-print { padding: 10px 20px; background: #e1251b; color: white; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>
    <div class="btn-panel">
        <button class="btn-print" onclick="window.print()">GERAR PDF</button>
        <button onclick="limparTudo()" style="display: block; width: 100%; margin-top: 5px; padding: 10px; background: #d9534f; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 12px;">ZERAR FORMULÁRIO</button>
        <button onclick="window.location.href='index.html'" style="display: block; width: 100%; margin-top: 5px; padding: 10px; background: #5bc0de; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 12px;">VOLTAR AO MENU</button>
    </div>
    
    <div id="sig-modal">
        <div class="modal-content">
            <div style="padding:10px; text-align:center; font-weight:bold;">ASSINE ABAIXO</div>
            <canvas id="modal-canvas"></canvas>
            <div class="modal-footer">
                <button class="btn-modal" style="background:#666;" onclick="clearModal()">Limpar</button>
                <button class="btn-modal" style="background:#dc3545;" onclick="closeModal()">Sair</button>
                <button class="btn-modal" style="background:#28a745;" onclick="saveSignature()">Confirmar</button>
            </div>
        </div>
    </div>

    <div class="page">
        <img src="https://logodownload.org/wp-content/uploads/2014/10/embratel-logo-1.png" class="embratel-bg">

        <div class="content">
            <div class="header-logo"><img src="https://logodownload.org/wp-content/uploads/2014/02/claro-logo-8.png" class="logo-claro"></div>

            <div class="title">TERMO DE ENTREGA <input type="text" id="input_projeto" value="PRO.00.7063"> (PROJETO VOIP)</div>

            <div class="text-body">
                Este presente termo visa atestar que foram entregues 
                <input type="text" id="input_local" class="input-fill" style="width: 360px;" value="MPSP-Promotoria de Justiça-Conchal - ID 014677/08">, 
                os itens da ativação VoIP sob o Protocolo <strong>SAOG – </strong> 
                <input type="text" id="input_protocolo" class="input-fill" style="width: 115px;" value="251506777778">.
            </div>

            <div class="table-container">
                <table class="item-table">
                    <thead>
                        <tr>
                            <th>Descrição</th>
                            <th style="width: 130px;">QUANTIDADE</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="td-center"><input type="text" id="input_desc" value="Telefone Básico – ( Yealink-T30 P )"></td>
                            <td class="td-center"><input type="text" id="input_qtd" class="input-bold" value="02 UNIDADE (S)"></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="obs">
                <strong>Observações:</strong><br>
                * Confirmar se os aparelhos TARS contem fonte de alimentação AC
            </div>

            <div class="sig-section">
                <div class="sig-row">
                    <span class="sig-label">Entregue por:</span>
                    <div class="sig-box" id="box-s1" onclick="openModal('s1')"></div>
                </div>
                <input type="text" id="tec_nome" placeholder="Nome / CPF do Técnico" style="width: 350px; margin-left: 95px; border:none; border-bottom: 1px dotted #ccc; font-size: 10px; outline:none; background:transparent;">
                <span class="label-sub">(Assinatura/ carimbo)</span>

                <div class="sig-row">
                    <span class="sig-label">Recebido por:</span>
                    <div class="sig-box" id="box-s2" onclick="openModal('s2')"></div>
                </div>
                <input type="text" id="rec_nome" placeholder="Nome / RG do Recebedor" style="width: 350px; margin-left: 95px; border:none; border-bottom: 1px dotted #ccc; font-size: 10px; outline:none; background:transparent;">
                <span class="label-sub">(Assinatura/ carimbo)</span>
            </div>

            <div class="date-footer">
                São Paulo, 
                <input type="text" id="data_dia" class="date-input" style="width: 35px;" placeholder="00"> de 
                <input type="text" id="data_mes" class="date-input" style="width: 90px;" placeholder="mês"> de 
                <input type="text" id="data_ano" class="date-input" style="width: 55px;" value="2026">. 
            </div>
        </div>
    </div>

    <script>
        const modal = document.getElementById('sig-modal');
        const mCanvas = document.getElementById('modal-canvas');
        const mCtx = mCanvas.getContext('2d');
        let currentTarget = ''; let drawing = false;

        function setupModalCanvas() {
            const ratio = 2; 
            mCanvas.width = mCanvas.offsetWidth * ratio; 
            mCanvas.height = mCanvas.offsetHeight * ratio;
            mCtx.scale(ratio, ratio); 
            mCtx.lineWidth = 3; 
            mCtx.lineCap = 'round'; 
            mCtx.strokeStyle = '#00008B';
        }

        function openModal(id) { currentTarget = id; modal.style.display = 'flex'; setupModalCanvas(); }
        function closeModal() { modal.style.display = 'none'; }
        function clearModal() { mCtx.clearRect(0, 0, mCanvas.width, mCanvas.height); }
        
        function saveSignature() {
            const box = document.getElementById('box-' + currentTarget);
            box.innerHTML = `<img src="${mCanvas.toDataURL()}">`;
            closeModal();
        }

        function getPos(e) {
            const rect = mCanvas.getBoundingClientRect();
            const touch = e.touches ? e.touches[0] : e;
            return { x: touch.clientX - rect.left, y: touch.clientY - rect.top };
        }

        mCanvas.addEventListener('touchstart', (e) => { drawing = true; mCtx.beginPath(); const p = getPos(e); mCtx.moveTo(p.x, p.y); e.preventDefault(); });
        mCanvas.addEventListener('touchmove', (e) => { if(!drawing) return; const p = getPos(e); mCtx.lineTo(p.x, p.y); mCtx.stroke(); e.preventDefault(); });
        mCanvas.addEventListener('touchend', () => drawing = false);
        mCanvas.addEventListener('mousedown', (e) => { drawing = true; mCtx.beginPath(); const p = getPos(e); mCtx.moveTo(p.x, p.y); });
        mCanvas.addEventListener('mousemove', (e) => { if(!drawing) return; const p = getPos(e); mCtx.lineTo(p.x, p.y); mCtx.stroke(); });
        window.addEventListener('mouseup', () => drawing = false);

        // FUNÇÕES DE PERSISTÊNCIA DE DADOS
        function salvarDados() {
            const inputs = document.querySelectorAll('input');
            inputs.forEach(input => {
                if (input.id) {
                    localStorage.setItem(window.location.pathname + input.id, input.value);
                }
            });
        }

        function carregarDados() {
            const inputs = document.querySelectorAll('input');
            inputs.forEach(input => {
                const salvo = localStorage.getItem(window.location.pathname + input.id);
                if (input.id && salvo) {
                    input.value = salvo;
                }
            });
        }

        function limparTudo() {
            if (confirm("Tem certeza que deseja apagar todos os dados do formulário?")) {
                localStorage.clear();
                location.reload();
            }
        }

        window.onload = function() {
            carregarDados();
            const inputs = document.querySelectorAll('input');
            inputs.forEach(input => {
                input.addEventListener('input', salvarDados);
            });
        };
    </script>
</body>
</html>
